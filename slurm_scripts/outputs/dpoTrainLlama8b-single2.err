/sorgin1/users/jbarrutia006/viper/scripts/dpotrain.py:8: UserWarning: WARNING: Unsloth should be imported before trl, transformers, peft to ensure all optimizations are applied. Your code may run slower or encounter memory issues without these optimizations.

Please restructure your imports with 'import unsloth' at the top of your file.
  from unsloth import FastLanguageModel, PatchDPOTrainer, is_bfloat16_supported
wandb: Currently logged in as: jbarrutia006 (jbarrutia006-upv-ehu). Use `wandb login --relogin` to force relogin
wandb: wandb version 0.19.8 is available!  To upgrade, please run:
wandb:  $ pip install wandb --upgrade
wandb: Tracking run with wandb version 0.17.0
wandb: Run data is saved locally in /sorgin1/users/jbarrutia006/viper/wandb/run-20250315_220420-xctddvib
wandb: Run `wandb offline` to turn off syncing.
wandb: Syncing run Dataset Single. lr 5e-6. beta=0.05. batch size=32. warmup 0.2
wandb: ‚≠êÔ∏è View project at https://wandb.ai/jbarrutia006-upv-ehu/viperDPO
wandb: üöÄ View run at https://wandb.ai/jbarrutia006-upv-ehu/viperDPO/runs/xctddvib
2025-03-15 22:04:21,120 - INFO - Loading model and tokenizer...
Loading checkpoint shards:   0%|          | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:  25%|‚ñà‚ñà‚ñå       | 1/4 [00:01<00:05,  1.84s/it]Loading checkpoint shards:  50%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 2/4 [00:03<00:03,  1.96s/it]Loading checkpoint shards:  75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 3/4 [00:05<00:01,  1.95s/it]Loading checkpoint shards: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 4/4 [00:06<00:00,  1.47s/it]Loading checkpoint shards: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 4/4 [00:06<00:00,  1.64s/it]
Unsloth 2025.3.14 patched 32 layers with 32 QKV layers, 32 O layers and 32 MLP layers.
2025-03-15 22:04:42,381 - INFO - Loading dataset from /sorgin1/users/jbarrutia006/viper/PrefDatasets/dpo_dataset_single_train.arrow as train and /sorgin1/users/jbarrutia006/viper/PrefDatasets/dpo_dataset_single_dev.arrow as dev
2025-03-15 22:04:42,398 - INFO - Initializing DPOTrainer...
2025-03-15 22:04:43,198 - WARNING - Detected kernel version 4.18.0, which is below the recommended minimum of 5.5.0; this can cause the process to hang. It is recommended to upgrade the kernel to the minimum version or higher.
2025-03-15 22:04:43,214 - INFO - Performing pre-training evaluation on the dev dataset...
  0%|          | 0/125 [00:00<?, ?it/s]  2%|‚ñè         | 2/125 [00:03<03:49,  1.86s/it]  2%|‚ñè         | 3/125 [00:07<05:12,  2.56s/it]  3%|‚ñé         | 4/125 [00:09<05:10,  2.57s/it]  4%|‚ñç         | 5/125 [00:12<04:58,  2.49s/it]  5%|‚ñç         | 6/125 [00:14<04:42,  2.37s/it]  6%|‚ñå         | 7/125 [00:16<04:38,  2.36s/it]  6%|‚ñã         | 8/125 [00:18<04:31,  2.32s/it]  7%|‚ñã         | 9/125 [00:20<03:55,  2.03s/it]  8%|‚ñä         | 10/125 [00:22<03:44,  1.95s/it]  9%|‚ñâ         | 11/125 [00:23<03:40,  1.94s/it] 10%|‚ñâ         | 12/125 [00:26<03:44,  1.98s/it] 10%|‚ñà         | 13/125 [00:28<03:50,  2.06s/it] 11%|‚ñà         | 14/125 [00:29<03:34,  1.93s/it] 12%|‚ñà‚ñè        | 15/125 [00:31<03:21,  1.83s/it] 13%|‚ñà‚ñé        | 16/125 [00:33<03:15,  1.79s/it] 14%|‚ñà‚ñé        | 17/125 [00:34<03:03,  1.70s/it] 14%|‚ñà‚ñç        | 18/125 [00:36<03:09,  1.77s/it] 15%|‚ñà‚ñå        | 19/125 [00:37<02:48,  1.59s/it] 16%|‚ñà‚ñå        | 20/125 [00:39<02:50,  1.63s/it] 17%|‚ñà‚ñã        | 21/125 [00:40<02:41,  1.56s/it] 18%|‚ñà‚ñä        | 22/125 [00:43<03:01,  1.76s/it] 18%|‚ñà‚ñä        | 23/125 [00:44<02:48,  1.65s/it] 19%|‚ñà‚ñâ        | 24/125 [00:46<02:42,  1.61s/it] 20%|‚ñà‚ñà        | 25/125 [00:48<03:06,  1.87s/it] 21%|‚ñà‚ñà        | 26/125 [00:51<03:26,  2.09s/it] 22%|‚ñà‚ñà‚ñè       | 27/125 [00:53<03:29,  2.14s/it] 22%|‚ñà‚ñà‚ñè       | 28/125 [00:56<03:44,  2.32s/it] 23%|‚ñà‚ñà‚ñé       | 29/125 [00:58<03:37,  2.27s/it] 24%|‚ñà‚ñà‚ñç       | 30/125 [00:59<03:12,  2.02s/it] 25%|‚ñà‚ñà‚ñç       | 31/125 [01:01<03:04,  1.96s/it] 26%|‚ñà‚ñà‚ñå       | 32/125 [01:03<02:56,  1.90s/it] 26%|‚ñà‚ñà‚ñã       | 33/125 [01:05<03:00,  1.97s/it] 27%|‚ñà‚ñà‚ñã       | 34/125 [01:07<03:06,  2.05s/it] 28%|‚ñà‚ñà‚ñä       | 35/125 [01:10<03:22,  2.25s/it] 29%|‚ñà‚ñà‚ñâ       | 36/125 [01:12<03:13,  2.17s/it] 30%|‚ñà‚ñà‚ñâ       | 37/125 [01:14<03:23,  2.31s/it] 30%|‚ñà‚ñà‚ñà       | 38/125 [01:17<03:25,  2.36s/it] 31%|‚ñà‚ñà‚ñà       | 39/125 [01:20<03:34,  2.49s/it] 